{# templates/products/cannot_delete.html #}
{% extends "base.html" %}
{% block title %}Cannot delete product{% endblock %}

{% block content %}
  <div class="container py-4">
    <h3>Cannot delete product: {{ product.name }}</h3>
    <p class="text-danger">
      This product is referenced by existing purchases or invoices and cannot be deleted by your account.
      If you are the business owner, you may choose to remove the product from the admin interface which will also
      remove related purchase/invoice line items (this is destructive).
    </p>

    <h5>Related Purchase Items ({{ related.purchases.count }})</h5>
    <ul>
      {% for p in related.purchases %}
        <li>{{ p.purchase }} — {{ p }}</li>
      {% empty %}
        <li>No purchase items found.</li>
      {% endfor %}
    </ul>

    <h5>Related Invoice Items ({{ related.invoices.count }})</h5>
    <ul>
      {% for i in related.invoices %}
        <li>{{ i.invoice }} — {{ i }}</li>
      {% empty %}
        <li>No invoice items found.</li>
      {% endfor %}
    </ul>

    <p>
      <a href="{% url 'products:detail' product.pk %}" class="btn btn-secondary">Back to product</a>
      {% if request.user.is_authenticated and product.business.owner_id == request.user.id %}
        <form method="post" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">Force delete (owner)</button>
        </form>
      {% endif %}
    </p>

    <div class="alert alert-warning mt-3">
      <strong>Warning:</strong> Forcing deletion will <em>permanently remove</em> the related purchase and invoice items.
      Consider archiving the product instead if you need to keep history.
    </div>
  </div>
{% endblock %}
