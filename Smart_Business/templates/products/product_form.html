{% extends 'base.html' %}
{% block title %}Add Product - SmartBiz{% endblock %}

{% block content %}
<div class="card p-4">
  <h4 class="mb-3">Add Product for {{ business.name }}</h4>

  <form method="post" novalidate>
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {% for error in form.non_field_errors %}
          <div>{{ error }}</div>
        {% endfor %}
      </div>
    {% endif %}

    {# Business field: often hidden if you set it in the view. Render either way. #}
    {% if form.business %}
      {% if form.business.is_hidden %}
        {{ form.business }}
      {% else %}
        <div class="mb-3">
          {{ form.business.label_tag }}
          {{ form.business }}
          {% if form.business.help_text %}
            <small class="form-text text-muted">{{ form.business.help_text }}</small>
          {% endif %}
          {% for error in form.business.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endif %}

    {# --- CATEGORY: render as manual text input (user types category name) --- #}
    <div class="mb-3">
      {# Use the form field label if available, otherwise show 'Category' #}
      <label for="id_category">
        {% if form.category.label %}{{ form.category.label }}{% else %}Category{% endif %}
      </label>

      {# Render a plain text input bound to the form field value #}
      <input
        type="text"
        name="{{ form.category.html_name }}"
        id="id_category"
        value="{{ form.category.value|default_if_none:'' }}"
        class="form-control"
        placeholder="e.g. Dairy Products"
      />

      {% if form.category.help_text %}
        <small class="form-text text-muted">{{ form.category.help_text }}</small>
      {% endif %}

      {% for error in form.category.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <div class="mb-3">
      {{ form.name.label_tag }}
      {{ form.name }}
      {% if form.name.help_text %}
        <small class="form-text text-muted">{{ form.name.help_text }}</small>
      {% endif %}
      {% for error in form.name.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <div class="mb-3">
      {{ form.base_unit.label_tag }}
      {{ form.base_unit }}
      {% if form.base_unit.help_text %}
        <small class="form-text text-muted">{{ form.base_unit.help_text }}</small>
      {% endif %}
      {% for error in form.base_unit.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <div class="mb-3">
      {{ form.price_per_unit.label_tag }}
      {{ form.price_per_unit }}
      {% if form.price_per_unit.help_text %}
        <small class="form-text text-muted">{{ form.price_per_unit.help_text }}</small>
      {% endif %}
      {% for error in form.price_per_unit.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <div class="mb-3">
      {{ form.stock_qty.label_tag }}
      {{ form.stock_qty }}
      {% if form.stock_qty.help_text %}
        <small class="form-text text-muted">{{ form.stock_qty.help_text }}</small>
      {% endif %}
      {% for error in form.stock_qty.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <div class="mb-3">
      {{ form.low_stock_threshold.label_tag }}
      {{ form.low_stock_threshold }}
      {% if form.low_stock_threshold.help_text %}
        <small class="form-text text-muted">{{ form.low_stock_threshold.help_text }}</small>
      {% endif %}
      {% for error in form.low_stock_threshold.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <button type="submit" class="btn btn-primary">Save</button>
    <a href="{% url 'products:product_list' %}" class="btn btn-outline-secondary ms-2">Cancel</a>
  </form>
</div>
{% endblock %}
