{# templates/purchase/purchase_detail.html #}
{% extends 'base.html' %}
{% block title %}
  Purchase {{ purchase.pk }}
{% endblock %}

{% block content %}
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h4 class="m-0">Purchase #{{ purchase.pk }}</h4>
        <small class="text-muted">Date: {{ purchase.date }} | Supplier: {{ purchase.supplier }}{{ purchase.company }}</small>
      </div>
      <div>
        <a class="btn btn-sm btn-warning" href="{% url 'purchases:purchase_edit' purchase.pk %}">Edit</a>
        <form method="post" action="{% url 'purchases:purchase_delete' purchase.pk %}" style="display:inline">
          {% csrf_token %}
          <button class="btn btn-sm btn-danger" type="submit" onclick="return confirm('Delete this purchase?')">Delete</button>
        </form>
        <a class="btn btn-sm btn-secondary" href="{% url 'purchases:purchase_list' %}">Back</a>
      </div>
    </div>

    <div class="card mb-3 p-3">
      <p>
        <strong>Supplier:</strong> {{ purchase.supplier }} <br />
        <strong>Company:</strong> {{ purchase.company }} <br />
        <strong>Phone:</strong> {{ purchase.phone }}
      </p>
      <p>
        <strong>Total:</strong> ₹{{ purchase.total }}
      </p>
    </div>

    <div class="card p-3">
      <h6>Items</h6>
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Product</th>
            <th class="text-end">Quantity</th>
            <th class="text-end">Unit Cost</th>
            <th class="text-end">Line Total</th>
          </tr>
        </thead>
        <tbody>
          {% for it in items %}
            <tr>
              <td>{{ it.product.name }}</td>
              <td class="text-end">{{ it.quantity }} {{ it.product.base_unit }}</td>
              <td class="text-end">{{ it.unit_cost }}</td>
              <td class="text-end">
                ₹{{ it.quantity|floatformat:3|floatformat }} <!-- you can compute locally if needed -->
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4" class="text-center text-muted">No items</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
